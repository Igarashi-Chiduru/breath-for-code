---
title: 开始设计
order: 3
---

# 设计思路

## 规范化

为了多人协作开发同一个项目的时候方便代码的可读性，以及新人接手项目的时候上手速度，一个项目必须拥有规范化，包括代码规范、文件命名规范、git 规范等等。以便管理项目。

**代码规范**包括 变量命名规则、代码缩进、可读性高、注释等等等等。  
**文件命名规范**是为了方便别人一看到文件名就明白这个文件的大致作用，以防双方都造同一个轮子，浪费人力，增加代码量。  
**git 规范**包括，分支命名规范，commit 提交规范等等，方便回溯问题等。

> 代码规范可以使用 eslint 进行最基本的一些限制，配合 prettier 自动保存格式化，可以约束代码风格等。其余的一些不太好限制的可以写一个 md 文件，将一些规则写入在里面，比如：尽可能不要使用一些可读性极差的代码（如：取整尽量使用 Math.floor，而不要使用 | ）。

> git 规范（举个例子，不是最终版本，后期确定再修改）：
>
> 1. **分支命名：** feature\_分支功能
> 2. **commit 规范：** 操作类型: 涉及区块 涉及文件(夹) 提交功能
>    > 操作类型主要分为: fix（修改 bug）、feat（新增功能/模块）、style（修改 ui 或者不涉及业务）、update（更新依赖）等。  
>    > 举个例子：修复了一个 components 下面 Button 组件的点击事件，commit 则为: fix: components Button 修改 Button 组件点击事件。

## 存储模板

一个模板应该包含以下三个文件或者文件夹：

### 自定义问题管理 json

设置一个 **meta.json** 文件，设置自定义的问题，将问题与答案保存在这里，所有的命令的交互问题都存放在此，方便维护与更新。

设置的问题用于创建模板或者其他命令使用，如：

- 项目名称
- 项目描述
- 项目作者
- 可选择使用的库

等等。

### tpls 文件夹

存放项目模板的文件夹，根据初始化时用户的回答和选择生成项目。

### generator 文件夹

执行 cli 命令时，由 cli 调用，主要用来自定义一些问题、模板文件信息等。

> 可以考虑将模板文件直接单独建立一个项目防止在 git 上，每次需要创建新项目的时候选择去 git 拉取模板来使用。
> todo： 如何将参数传入 clone 下来的文件模板中并生成最终文件

## 目录结构

后续有需要添加的再加

```
.
├── bin           //命令配置
├── index.js      //主入口
├── src           //功能文件
├── generator     //执行命令的回调方法
├── tpls          //模板目录
├── types         //ts定义文件夹
├── utils         //公用的方法
├── package.json  //包信息
├── README.md     //说明文档
├── .eslintrc.js  //eslint配置文件
├── .gitignore
└── test          //测试用例
```

## 功能设计

开发团队的 cli，首先得先确定需要的功能，根据项目所需开发相应的功能去服务于项目。

先根据目前的需要定义几个功能作为目标去开发实现，后续有需要添加的再加。

### 模板

首先，开发 cli 的最基本的需求就是模板，减少代码的 copy 以及提高开发新项目的便捷和可拓展性。

- **团队目前使用的统一框架是 umi，且已经根据业务产生了一些可拔插式的插件，所以模板的设计可以先抄一个现有的项目，并且将团队目前的插件中一些不是所有项目必须的插件列出来供初始化时选择**

模板的创建目前选择的方案是 **mustache** 插件，根据初始化时用户回答问题的答案去生成相应的文件。  
暂定第一版的一些问题：

1. 项目文件名称
2. 项目名称(默认项目文件名称)
3. 项目描述
4. 作者
5. 选取项目中需要使用的插件

> todo: 还是上面的问题，调研如何将 git clone 下来的模板代码根据用户回答生成成为可用的项目代码。（如果目前没有思路解决，先将模板代码放置在 cli 代码中，后续再解决）。

因为团队项目主要分为两种大类型，**后台管理系统**和**移动端 h5 项目**，所以需要配置两种模板，用户可以根据自己需求去选择模板生成。

### 配置（进阶）

在生成的项目根目录下创建一个配置文件 xx.config.js(未确定名字) ，将一些可以定制的功能配置放入在其中，可以在项目中使用（目前没有想到什么配置，因为很多配置其实可以直接写 umi 插件解决了）。

### 命令（进阶）

在 cli 中初始设置一些命令，用来方便在项目中节省人力成本，如：

- 生成页面文件模板，后台管理系统的页面主要就是 form+table 组合，可以设置初始模板使用命令生成，节省了 cv 的时间。
- 列举模板 list，可以选择模板进行生成文件
- eslint 命令，对项目文件进行规范以及代码错误排查。
  等等，后续有想到再补充。

为了方便每个项目可以定制自己项目的一些小插件来服务于业务，可以提供自定义命令的功能，在项目根目录定义一个文件夹来收集项目的命令配置，cli 通过收集配置来执行相应的操作。（进阶中的进阶）

### 工具（滞后）

目前来说，团队中对于小工具的需求解决办法还是通过 umi 插件来解决，无论是 cli 或者插件解决都是比较合适的办法，目前工具功能可以滞后后续再 battle，先记录在这里，如果有需要可以再次开发。

### ui（目前仅限于设想）

使用命令启动 cli 的 ui 界面，提供操作界面让用户监控项目运行以及命令行可视化操作。
